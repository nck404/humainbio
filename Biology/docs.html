<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Học Lý Thuyết Sinh Học</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="./u/style/docs.css" />
  </head>
  <body>
    <div class="flex">
      <!-- Mobile Overlay -->
      <div
        class="mobile-overlay"
        id="mobileOverlay"
        onclick="closeMobileMenu()"
      ></div>

      <!-- Sidebar -->
      <div class="sidebar w-80 fixed left-0 top-0" id="sidebar">
        <div class="p-6">
          <div class="flex items-center gap-3 mb-6">
            <i
              class="bx bxs-book-heart text-4xl"
              style="color: var(--ctp-flamingo)"
            ></i>
            <h1 class="text-2xl font-bold" style="color: var(--ctp-flamingo)">
              Sinh Học
            </h1>
          </div>

          <!-- Search -->
          <div class="relative mb-6" id="searchContainer">
            <i
              class="bx bx-search absolute left-3 top-3 text-xl"
              style="color: var(--ctp-subtext0)"
            ></i>
            <input
              type="text"
              id="searchInput"
              placeholder="Tìm kiếm bài học..."
              class="search-box w-full pl-10"
            />
          </div>

          <!-- Menu -->
          <div id="menuContainer"></div>
        </div>
      </div>

      <!-- Mobile Menu Button -->
      <button
        class="mobile-menu-btn"
        id="mobileMenuBtn"
        onclick="toggleMobileMenu()"
      >
        <i class="bx bx-menu"></i>
      </button>

      <!-- Content Area -->
      <div class="content-area ml-80 flex-1">
        <div class="max-w-4xl mx-auto">
          <div class="title-box" id="title-box">
            <div class="icon-container" id="icon-container"></div>
            <h1 class="text-3xl font-bold mb-2" id="titleText">
              Chào mừng đến với Sinh Học!
            </h1>
            <p class="opacity-90" id="subtitleText">
              Chọn một bài học từ menu bên trái để bắt đầu
            </p>
          </div>

          <div class="markdown-content" id="contentArea">
            <div class="text-center py-20">
              <i
                class="bx bx-book-open text-8xl mb-4"
                style="color: var(--ctp-pink); opacity: 0.3"
              ></i>
              <p class="text-xl" style="color: var(--ctp-subtext1)">
                Hãy chọn một chủ đề để bắt đầu học
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <button class="chat-button" onclick="toggleChat()">
      <svg viewBox="0 0 24 24">
        <path
          d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"
        />
      </svg>
    </button>

    <div class="chat-window" id="chatWindow">
      <div class="chat-header">
        <h3>test</h3>
        <button class="close-btn" onclick="toggleChat()">×</button>
      </div>
      <div class="chat-messages" id="chatMessages">
        <div class="message bot">
          <div class="message-content">Xin chào!</div>
        </div>
      </div>
      <div class="chat-input-container">
        <input
          type="text"
          class="chat-input"
          id="chatInput"
          placeholder="Nhập tin nhắn..."
          onkeypress="handleKeyPress(event)"
        />
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">
          <svg viewBox="0 0 24 24">
            <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
          </svg>
        </button>
      </div>
    </div>
    <script src="./u/docs.js"></script>
    <script>

      function toggleChat() {
        const chatWindow = document.getElementById("chatWindow");
        chatWindow.classList.toggle("active");
        if (chatWindow.classList.contains("active")) {
          document.getElementById("chatInput").focus();
        }
      }

      function handleKeyPress(e) {
        if (e.key === "Enter") {
          sendMessage();
        }
      }

      function addMessage(text, isUser) {
        const messagesContainer = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${isUser ? "user" : "bot"}`;

        const contentDiv = document.createElement("div");
        contentDiv.className = "message-content";
        contentDiv.textContent = text;

        messageDiv.appendChild(contentDiv);
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function showTypingIndicator() {
        const messagesContainer = document.getElementById("chatMessages");
        const typingDiv = document.createElement("div");
        typingDiv.className = "message bot";
        typingDiv.id = "typingIndicator";

        const indicatorDiv = document.createElement("div");
        indicatorDiv.className = "typing-indicator active";
        indicatorDiv.innerHTML = "<span></span><span></span><span></span>";

        typingDiv.appendChild(indicatorDiv);
        messagesContainer.appendChild(typingDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function removeTypingIndicator() {
        const typingIndicator = document.getElementById("typingIndicator");
        if (typingIndicator) {
          typingIndicator.remove();
        }
      }

      async function sendMessage() {
        const input = document.getElementById("chatInput");
        const sendBtn = document.getElementById("sendBtn");
        const message = input.value.trim();

        if (!message) return;

        addMessage(message, true);
        input.value = "";
        sendBtn.disabled = true;
        showTypingIndicator();

        try {
          const response = await fetch(
            "https://<your-railway-app>.railway.app/api/chat",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                message: message,
                context: "", // nếu muốn lưu lịch sử hội thoại
              }),
            }
          );

          const data = await response.json();
          removeTypingIndicator();

          addMessage(data.response || "Không thể trả lời.", false);
        } catch (error) {
          removeTypingIndicator();
          addMessage("Lỗi kết nối đến server.", false);
          console.error(error);
        }

        sendBtn.disabled = false;
      }
    </script>
  </body>
</html>
